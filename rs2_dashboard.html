<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>rs2 scan 2025-09-01</title>
  <style>
    :root {
      --bg: #0f172a;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --card-bg: #0b1221;
      --card-border: #1f2937;
      --plot-bg: #0b1221;
      --grid: #1f2937;
      --accent-1: #38bdf8;
      --accent-2: #fbbf24;
      --accent-3: #34d399;
    }
    body.light {
      --bg: #f6f8fb;
      --text: #0f172a;
      --muted: #4b5563;
      --card-bg: #ffffff;
      --card-border: #e5e7eb;
      --plot-bg: #ffffff;
      --grid: #e5e7eb;
      --accent-1: #2563eb;
      --accent-2: #ea580c;
      --accent-3: #16a34a;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 24px;
      transition: background 0.2s ease, color 0.2s ease;
    }
    h1 { margin: 0; }
    h3 { margin-bottom: 6px; }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      gap: 12px;
      flex-wrap: wrap;
    }
    .toggle {
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .btn {
      background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      padding: 12px 14px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.18);
    }
    .label { color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .value { font-size: 22px; font-weight: 600; margin-top: 4px; }
    .charts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 14px;
      margin: 18px 0;
    }
    .chart {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.18);
    }
    .tables {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 14px;
    }
    .table-block {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.18);
    }
    .table-head, .chart-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      color: var(--text);
      font-size: 13px;
    }
    .data-table th, .data-table td {
      border: 1px solid var(--card-border);
      padding: 6px 8px;
      text-align: left;
    }
    .data-table th { background: var(--plot-bg); }
    .muted { color: var(--muted); font-size: 13px; }
    .notes {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 12px 14px;
      margin-bottom: 18px;
    }
    .notes ul { margin: 6px 0 0 16px; padding: 0; }
    .notes li { margin-bottom: 4px; line-height: 1.5; }
    .vin-block {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 12px 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.18);
      margin: 18px 0;
    }
    .vin-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .vin-head h3 { margin: 0; }
    .vin-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .vin-controls label { font-size: 13px; color: var(--text); font-weight: 700; letter-spacing: 0.2px; }
    .vin-controls select {
      background: linear-gradient(135deg, var(--plot-bg), var(--card-bg));
      color: var(--text);
      border: 2px solid var(--accent-1);
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 700;
      box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    }
    .vin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }
    .stat-card {
      background: var(--plot-bg);
      border: 1px solid var(--card-border);
      border-radius: 8px;
      padding: 10px;
    }
    .stat-card .label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-card .value { font-size: 18px; font-weight: 700; }
  </style>
</head>
<body class="dark">
  <div class="header">
    <h1>rs2 scan 2025-09-01</h1>
    <button id="theme-toggle" class="toggle" type="button">Switch to light mode</button>
  </div>
  <div class="cards">
        <div class="card">
            <div class="label">Total scans</div>
            <div class="value">25,221</div>
        </div>
        
        <div class="card">
            <div class="label">Total scanned users</div>
            <div class="value">14,213</div>
        </div>
        
        <div class="card">
            <div class="label">Average vehicle age</div>
            <div class="value">15.18</div>
        </div>
        
        <div class="card">
            <div class="label">Average mileage</div>
            <div class="value">161,571.00</div>
        </div>
        
        <div class="card">
            <div class="label">Average ABS code count</div>
            <div class="value">1.27</div>
        </div>
        
        <div class="card">
            <div class="label">Average SRS code count</div>
            <div class="value">1.02</div>
        </div>
        
        <div class="card">
            <div class="label">Maintenance parts (total)</div>
            <div class="value">27,435</div>
        </div>
        
        <div class="card">
            <div class="label">Predicted parts (total)</div>
            <div class="value">88,346</div>
        </div>
        
        <div class="card">
            <div class="label">Unique VINs</div>
            <div class="value">15,143</div>
        </div>
        
        <div class="card">
            <div class="label">Repeat users</div>
            <div class="value">5,059</div>
        </div>
        
        <div class="card">
            <div class="label">Repeat user share</div>
            <div class="value">35.6%</div>
        </div>
        
        <div class="card">
            <div class="label">Repeat users (>=2 scans within 1 hour)</div>
            <div class="value">4,550</div>
        </div>
        
        <div class="card">
            <div class="label">Unique VIN-user pairs</div>
            <div class="value">15,191</div>
        </div>
        </div>
  <div class="notes">
    <strong>Metric definitions</strong>
    <ul><li><strong>Total scans:</strong> All scan events in the dataset.</li><li><strong>Total scanned users:</strong> Distinct AccountId values with at least one scan.</li><li><strong>Average vehicle age:</strong> Mean of (2026 - Year) for valid years.</li><li><strong>Average mileage:</strong> Mean of mileage across scans.</li><li><strong>Average ABS code count:</strong> Mean of TotalAbsCodes where present.</li><li><strong>Average SRS code count:</strong> Mean of TotalSrsCodes where present.</li><li><strong>Maintenance parts (total):</strong> Sum of MaintenancePartsCount.</li><li><strong>Predicted parts (total):</strong> Sum of PredictedPartsCount.</li><li><strong>Unique VINs:</strong> Distinct VINs scanned.</li><li><strong>Repeat users:</strong> AccountId values that scanned the same VIN at least twice.</li><li><strong>Repeat user share:</strong> Share of scanned users who repeated on the same VIN.</li><li><strong>Repeat users (>=2 scans within 1 hour):</strong> Repeat users who had at least two scans (any VIN) within a 1-hour window.</li><li><strong>Unique VIN-user pairs:</strong> Distinct combinations of VIN and UserId (unique VINs scanned by unique users).</li></ul>
  </div>
  <div class="vin-block">
    <div class="vin-head">
      <div>
        <h3>VIN scan frequency</h3>
        <div class="muted">Share of the 15,143 unique VINs by number of scans.</div>
      </div>
      <div style="display: flex; gap: 8px; flex-wrap: wrap;">
        <button class="btn" onclick="downloadTable('vin_distribution')">Download CSV</button>
        <button class="btn" onclick="downloadChart('vin-chart','vin_scan_distribution')">Download PNG</button>
      </div>
    </div>
    <div class="vin-controls">
      <label for="vin-select">Select scan count:</label>
      <select id="vin-select"></select>
    </div>
    <div class="vin-stats">
      <div class="stat-card">
        <div class="label">VINs</div>
        <div class="value" id="vin-count-value">-</div>
      </div>
      <div class="stat-card">
        <div class="label">Share of unique VINs</div>
        <div class="value" id="vin-percent-value">-</div>
      </div>
    </div>
    <div id="vin-chart"></div>
  </div>
  <div class="tables">
    <div class='table-block'><div class='table-head'><h3>Top 10 vehicles (Year, Make, Model)</h3><button class='btn' onclick="downloadTable('top_vehicles')">Download CSV</button></div><table border="1" class="dataframe data-table">
  <thead>
    <tr style="text-align: right;">
      <th>Vehicle</th>
      <th>Scans</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2013 FORD F150</td>
      <td>111</td>
    </tr>
    <tr>
      <td>2007 CHEVROLET SILVERADO</td>
      <td>93</td>
    </tr>
    <tr>
      <td>2010 FORD F150</td>
      <td>91</td>
    </tr>
    <tr>
      <td>2003 CHEVROLET SILVERADO</td>
      <td>86</td>
    </tr>
    <tr>
      <td>2013 CHEVROLET SILVERADO</td>
      <td>85</td>
    </tr>
    <tr>
      <td>2017 CHEVROLET SILVERADO</td>
      <td>84</td>
    </tr>
    <tr>
      <td>2005 FORD F150</td>
      <td>81</td>
    </tr>
    <tr>
      <td>2014 CHEVROLET SILVERADO</td>
      <td>81</td>
    </tr>
    <tr>
      <td>2016 RAM 1500</td>
      <td>77</td>
    </tr>
    <tr>
      <td>2008 CHEVROLET SILVERADO</td>
      <td>75</td>
    </tr>
  </tbody>
</table></div><div class='table-block'><div class='table-head'><h3>Top 5 scan tools (UsbProductId)</h3><button class='btn' onclick="downloadTable('top_usb')">Download CSV</button></div><table border="1" class="dataframe data-table">
  <thead>
    <tr style="text-align: right;">
      <th>UsbProductId</th>
      <th>Scans</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>796</td>
      <td>11105</td>
    </tr>
    <tr>
      <td>942</td>
      <td>3032</td>
    </tr>
    <tr>
      <td>795</td>
      <td>2440</td>
    </tr>
    <tr>
      <td>932</td>
      <td>1130</td>
    </tr>
    <tr>
      <td>937</td>
      <td>984</td>
    </tr>
  </tbody>
</table></div><div class='table-block'><div class='table-head'><h3>Top 10 MIL DTC with common parts</h3><button class='btn' onclick="downloadTable('mil_dtc')">Download CSV</button></div><table border="1" class="dataframe data-table">
  <thead>
    <tr style="text-align: right;">
      <th>MIL DTC</th>
      <th>Scans</th>
      <th>Top Parts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>P0420</td>
      <td>860</td>
      <td>Catalytic Converter (601), Catalytic Converter with Integrated Exhaust Manifold (168), Exhaust Manifold Gasket (110)</td>
    </tr>
    <tr>
      <td>P0300</td>
      <td>525</td>
      <td>Spark Plug (282), Ignition Coil (188), Fuel System Cleaner (145)</td>
    </tr>
    <tr>
      <td>P0171</td>
      <td>439</td>
      <td>Mass Air Flow Sensor (292), Engine Intake Manifold Gasket (89), PCV Valve (63)</td>
    </tr>
    <tr>
      <td>P0456</td>
      <td>293</td>
      <td>Fuel Tank Cap (142), Evaporative System Integrity Module (ESIM) (124), Vapor Canister Purge Valve (62)</td>
    </tr>
    <tr>
      <td>P0430</td>
      <td>284</td>
      <td>Catalytic Converter (217), Oxygen Sensor (65), Catalytic Converter with Integrated Exhaust Manifold (63)</td>
    </tr>
    <tr>
      <td>P0301</td>
      <td>274</td>
      <td>Spark Plug (248), Ignition Coil (222), Fuel Injector (53)</td>
    </tr>
    <tr>
      <td>P0302</td>
      <td>265</td>
      <td>Ignition Coil (208), Spark Plug (204), Fuel Injector (35)</td>
    </tr>
    <tr>
      <td>P0455</td>
      <td>235</td>
      <td>Fuel Tank Cap (96), Vapor Canister Purge Valve (53), Vapor Canister Purge Solenoid (47)</td>
    </tr>
    <tr>
      <td>P0303</td>
      <td>219</td>
      <td>Ignition Coil (171), Spark Plug (164), Fuel Injector (58)</td>
    </tr>
    <tr>
      <td>P0442</td>
      <td>187</td>
      <td>Fuel Tank Cap (63), Vapor Canister Purge Valve (61), Vapor Canister Vent Solenoid (45)</td>
    </tr>
  </tbody>
</table></div><div class='table-block'><div class='table-head'><h3>Top 10 ABS part names</h3><button class='btn' onclick="downloadTable('abs_parts')">Download CSV</button></div><table border="1" class="dataframe data-table">
  <thead>
    <tr style="text-align: right;">
      <th>ABS Part Name</th>
      <th>Mentions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ABS Wheel Speed Sensor</td>
      <td>656</td>
    </tr>
    <tr>
      <td>Vehicle Battery</td>
      <td>252</td>
    </tr>
    <tr>
      <td>ABS Control Module</td>
      <td>231</td>
    </tr>
    <tr>
      <td>ABS Modulator</td>
      <td>122</td>
    </tr>
    <tr>
      <td>Electronic Brake Control Module</td>
      <td>113</td>
    </tr>
    <tr>
      <td>Steering Angle Sensor</td>
      <td>111</td>
    </tr>
    <tr>
      <td>Suspension Yaw Sensor</td>
      <td>109</td>
    </tr>
    <tr>
      <td>Wheel Bearing and Hub Assembly</td>
      <td>73</td>
    </tr>
    <tr>
      <td>Engine Control Module</td>
      <td>61</td>
    </tr>
    <tr>
      <td>Brake Light Switch</td>
      <td>60</td>
    </tr>
  </tbody>
</table></div><div class='table-block'><div class='table-head'><h3>Top 10 SRS part names</h3><button class='btn' onclick="downloadTable('srs_parts')">Download CSV</button></div><table border="1" class="dataframe data-table">
  <thead>
    <tr style="text-align: right;">
      <th>SRS Part Name</th>
      <th>Mentions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Vehicle Battery</td>
      <td>92</td>
    </tr>
    <tr>
      <td>Engine Wiring Harness Connector</td>
      <td>88</td>
    </tr>
    <tr>
      <td>Air Bag Clockspring</td>
      <td>72</td>
    </tr>
    <tr>
      <td>Air Bag Impact Sensor</td>
      <td>67</td>
    </tr>
    <tr>
      <td>Seat Belt</td>
      <td>50</td>
    </tr>
    <tr>
      <td>Occupant Detection Sensor</td>
      <td>45</td>
    </tr>
    <tr>
      <td>Air Bag Control Module</td>
      <td>44</td>
    </tr>
    <tr>
      <td>Air Bag Module</td>
      <td>26</td>
    </tr>
    <tr>
      <td>Steering Column Control Module</td>
      <td>20</td>
    </tr>
    <tr>
      <td>Instrument Cluster</td>
      <td>15</td>
    </tr>
  </tbody>
</table></div>
  </div>
  <div class="charts">
    <div class="chart">
      <div class="chart-head">
        <span>Scans in the last 24 hours (Pacific)</span>
        <button class="btn" onclick="downloadChart('hourly-chart','hourly_scans')">Download PNG</button>
      </div>
      <div id="hourly-chart"></div>
    </div>
    <div class="chart">
      <div class="chart-head">
        <span>Scans by state</span>
        <button class="btn" onclick="downloadChart('state-map','state_map')">Download PNG</button>
      </div>
      <div id="state-map"></div>
    </div>
    <div class="chart">
      <div class="chart-head">
        <span>Repeat users by state</span>
        <button class="btn" onclick="downloadChart('repeat-map','repeat_user_map')">Download PNG</button>
      </div>
      <div id="repeat-map"></div>
    </div>
    <div class="chart">
      <div class="chart-head">
        <span>Top states by scans</span>
        <button class="btn" onclick="downloadChart('state-bar','top_states')">Download PNG</button>
      </div>
      <div id="state-bar"></div>
    </div>
    <div class="chart">
      <div class="chart-head">
        <span>Top vehicles by scans</span>
        <button class="btn" onclick="downloadChart('vehicle-bar','top_vehicles')">Download PNG</button>
      </div>
      <div id="vehicle-bar"></div>
    </div>
  </div>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>
    const chartData = {"hourly": [{"Hour": "2025-08-31T17:00:00-07:00", "Scans": 1510}, {"Hour": "2025-08-31T18:00:00-07:00", "Scans": 1165}, {"Hour": "2025-08-31T19:00:00-07:00", "Scans": 936}, {"Hour": "2025-08-31T20:00:00-07:00", "Scans": 618}, {"Hour": "2025-08-31T21:00:00-07:00", "Scans": 414}, {"Hour": "2025-08-31T22:00:00-07:00", "Scans": 293}, {"Hour": "2025-08-31T23:00:00-07:00", "Scans": 159}, {"Hour": "2025-09-01T00:00:00-07:00", "Scans": 114}, {"Hour": "2025-09-01T01:00:00-07:00", "Scans": 95}, {"Hour": "2025-09-01T02:00:00-07:00", "Scans": 88}, {"Hour": "2025-09-01T03:00:00-07:00", "Scans": 129}, {"Hour": "2025-09-01T04:00:00-07:00", "Scans": 197}, {"Hour": "2025-09-01T05:00:00-07:00", "Scans": 357}, {"Hour": "2025-09-01T06:00:00-07:00", "Scans": 658}, {"Hour": "2025-09-01T07:00:00-07:00", "Scans": 1138}, {"Hour": "2025-09-01T08:00:00-07:00", "Scans": 1434}, {"Hour": "2025-09-01T09:00:00-07:00", "Scans": 1787}, {"Hour": "2025-09-01T10:00:00-07:00", "Scans": 1933}, {"Hour": "2025-09-01T11:00:00-07:00", "Scans": 1977}, {"Hour": "2025-09-01T12:00:00-07:00", "Scans": 2070}, {"Hour": "2025-09-01T13:00:00-07:00", "Scans": 2049}, {"Hour": "2025-09-01T14:00:00-07:00", "Scans": 2070}, {"Hour": "2025-09-01T15:00:00-07:00", "Scans": 2076}, {"Hour": "2025-09-01T16:00:00-07:00", "Scans": 1954}], "scans_by_state": [{"State": "TX", "Scans": 2633}, {"State": "CA", "Scans": 2223}, {"State": "FL", "Scans": 1526}, {"State": "GA", "Scans": 934}, {"State": "NC", "Scans": 882}, {"State": "NY", "Scans": 781}, {"State": "IL", "Scans": 774}, {"State": "PA", "Scans": 773}, {"State": "OH", "Scans": 713}, {"State": "VA", "Scans": 641}, {"State": "TN", "Scans": 640}, {"State": "MI", "Scans": 599}, {"State": "IN", "Scans": 591}, {"State": "MO", "Scans": 574}, {"State": "WA", "Scans": 524}, {"State": "AZ", "Scans": 486}, {"State": "AL", "Scans": 484}, {"State": "SC", "Scans": 454}, {"State": "CO", "Scans": 450}, {"State": "KY", "Scans": 447}, {"State": "LA", "Scans": 430}, {"State": "OK", "Scans": 428}, {"State": "NJ", "Scans": 410}, {"State": "MS", "Scans": 400}, {"State": "WI", "Scans": 381}, {"State": "AR", "Scans": 379}, {"State": "MN", "Scans": 326}, {"State": "MD", "Scans": 312}, {"State": "MA", "Scans": 302}, {"State": "UT", "Scans": 281}, {"State": "OR", "Scans": 274}, {"State": "IA", "Scans": 262}, {"State": "KS", "Scans": 234}, {"State": "NV", "Scans": 217}, {"State": "CT", "Scans": 203}, {"State": "NM", "Scans": 201}, {"State": "NE", "Scans": 197}, {"State": "WV", "Scans": 162}, {"State": "ID", "Scans": 153}, {"State": "NH", "Scans": 113}, {"State": "MT", "Scans": 107}, {"State": "HI", "Scans": 97}, {"State": "PR", "Scans": 96}, {"State": "ME", "Scans": 94}, {"State": "DE", "Scans": 78}, {"State": "SD", "Scans": 74}, {"State": "ND", "Scans": 67}, {"State": "RI", "Scans": 66}, {"State": "AK", "Scans": 52}, {"State": "WY", "Scans": 36}, {"State": "VT", "Scans": 31}, {"State": "DC", "Scans": 13}, {"State": "GU", "Scans": 11}, {"State": "AP", "Scans": 1}], "repeat_users_by_state": [{"State": "AK", "RepeatUsers": 12}, {"State": "AL", "RepeatUsers": 107}, {"State": "AR", "RepeatUsers": 79}, {"State": "AZ", "RepeatUsers": 103}, {"State": "CA", "RepeatUsers": 447}, {"State": "CO", "RepeatUsers": 90}, {"State": "CT", "RepeatUsers": 40}, {"State": "DC", "RepeatUsers": 3}, {"State": "DE", "RepeatUsers": 19}, {"State": "FL", "RepeatUsers": 293}, {"State": "GA", "RepeatUsers": 178}, {"State": "GU", "RepeatUsers": 2}, {"State": "HI", "RepeatUsers": 11}, {"State": "IA", "RepeatUsers": 58}, {"State": "ID", "RepeatUsers": 32}, {"State": "IL", "RepeatUsers": 165}, {"State": "IN", "RepeatUsers": 120}, {"State": "KS", "RepeatUsers": 47}, {"State": "KY", "RepeatUsers": 94}, {"State": "LA", "RepeatUsers": 103}, {"State": "MA", "RepeatUsers": 58}, {"State": "MD", "RepeatUsers": 55}, {"State": "ME", "RepeatUsers": 19}, {"State": "MI", "RepeatUsers": 118}, {"State": "MN", "RepeatUsers": 65}, {"State": "MO", "RepeatUsers": 107}, {"State": "MS", "RepeatUsers": 81}, {"State": "MT", "RepeatUsers": 19}, {"State": "NC", "RepeatUsers": 170}, {"State": "ND", "RepeatUsers": 14}, {"State": "NE", "RepeatUsers": 42}, {"State": "NH", "RepeatUsers": 25}, {"State": "NJ", "RepeatUsers": 79}, {"State": "NM", "RepeatUsers": 44}, {"State": "NV", "RepeatUsers": 47}, {"State": "NY", "RepeatUsers": 145}, {"State": "OH", "RepeatUsers": 159}, {"State": "OK", "RepeatUsers": 85}, {"State": "OR", "RepeatUsers": 47}, {"State": "PA", "RepeatUsers": 150}, {"State": "PR", "RepeatUsers": 23}, {"State": "RI", "RepeatUsers": 16}, {"State": "SC", "RepeatUsers": 86}, {"State": "SD", "RepeatUsers": 12}, {"State": "TN", "RepeatUsers": 145}, {"State": "TX", "RepeatUsers": 536}, {"State": "UT", "RepeatUsers": 54}, {"State": "VA", "RepeatUsers": 124}, {"State": "VT", "RepeatUsers": 6}, {"State": "WA", "RepeatUsers": 102}, {"State": "WI", "RepeatUsers": 89}, {"State": "WV", "RepeatUsers": 25}, {"State": "WY", "RepeatUsers": 9}], "top_states": [{"State": "TX", "Scans": 2633}, {"State": "CA", "Scans": 2223}, {"State": "FL", "Scans": 1526}, {"State": "GA", "Scans": 934}, {"State": "NC", "Scans": 882}, {"State": "NY", "Scans": 781}, {"State": "IL", "Scans": 774}, {"State": "PA", "Scans": 773}, {"State": "OH", "Scans": 713}, {"State": "VA", "Scans": 641}], "top_vehicles": [{"Vehicle": "2013 FORD F150", "Scans": 111}, {"Vehicle": "2007 CHEVROLET SILVERADO", "Scans": 93}, {"Vehicle": "2010 FORD F150", "Scans": 91}, {"Vehicle": "2003 CHEVROLET SILVERADO", "Scans": 86}, {"Vehicle": "2013 CHEVROLET SILVERADO", "Scans": 85}, {"Vehicle": "2017 CHEVROLET SILVERADO", "Scans": 84}, {"Vehicle": "2005 FORD F150", "Scans": 81}, {"Vehicle": "2014 CHEVROLET SILVERADO", "Scans": 81}, {"Vehicle": "2016 RAM 1500", "Scans": 77}, {"Vehicle": "2008 CHEVROLET SILVERADO", "Scans": 75}], "top_usb": [{"UsbProductId": 796, "Scans": 11105}, {"UsbProductId": 942, "Scans": 3032}, {"UsbProductId": 795, "Scans": 2440}, {"UsbProductId": 932, "Scans": 1130}, {"UsbProductId": 937, "Scans": 984}], "mil_dtc": [{"MIL DTC": "P0420", "Scans": 860, "Top Parts": "Catalytic Converter (601), Catalytic Converter with Integrated Exhaust Manifold (168), Exhaust Manifold Gasket (110)"}, {"MIL DTC": "P0300", "Scans": 525, "Top Parts": "Spark Plug (282), Ignition Coil (188), Fuel System Cleaner (145)"}, {"MIL DTC": "P0171", "Scans": 439, "Top Parts": "Mass Air Flow Sensor (292), Engine Intake Manifold Gasket (89), PCV Valve (63)"}, {"MIL DTC": "P0456", "Scans": 293, "Top Parts": "Fuel Tank Cap (142), Evaporative System Integrity Module (ESIM) (124), Vapor Canister Purge Valve (62)"}, {"MIL DTC": "P0430", "Scans": 284, "Top Parts": "Catalytic Converter (217), Oxygen Sensor (65), Catalytic Converter with Integrated Exhaust Manifold (63)"}, {"MIL DTC": "P0301", "Scans": 274, "Top Parts": "Spark Plug (248), Ignition Coil (222), Fuel Injector (53)"}, {"MIL DTC": "P0302", "Scans": 265, "Top Parts": "Ignition Coil (208), Spark Plug (204), Fuel Injector (35)"}, {"MIL DTC": "P0455", "Scans": 235, "Top Parts": "Fuel Tank Cap (96), Vapor Canister Purge Valve (53), Vapor Canister Purge Solenoid (47)"}, {"MIL DTC": "P0303", "Scans": 219, "Top Parts": "Ignition Coil (171), Spark Plug (164), Fuel Injector (58)"}, {"MIL DTC": "P0442", "Scans": 187, "Top Parts": "Fuel Tank Cap (63), Vapor Canister Purge Valve (61), Vapor Canister Vent Solenoid (45)"}], "abs_parts": [{"ABS Part Name": "ABS Wheel Speed Sensor", "Mentions": 656}, {"ABS Part Name": "Vehicle Battery", "Mentions": 252}, {"ABS Part Name": "ABS Control Module", "Mentions": 231}, {"ABS Part Name": "ABS Modulator", "Mentions": 122}, {"ABS Part Name": "Electronic Brake Control Module", "Mentions": 113}, {"ABS Part Name": "Steering Angle Sensor", "Mentions": 111}, {"ABS Part Name": "Suspension Yaw Sensor", "Mentions": 109}, {"ABS Part Name": "Wheel Bearing and Hub Assembly", "Mentions": 73}, {"ABS Part Name": "Engine Control Module", "Mentions": 61}, {"ABS Part Name": "Brake Light Switch", "Mentions": 60}], "srs_parts": [{"SRS Part Name": "Vehicle Battery", "Mentions": 92}, {"SRS Part Name": "Engine Wiring Harness Connector", "Mentions": 88}, {"SRS Part Name": "Air Bag Clockspring", "Mentions": 72}, {"SRS Part Name": "Air Bag Impact Sensor", "Mentions": 67}, {"SRS Part Name": "Seat Belt", "Mentions": 50}, {"SRS Part Name": "Occupant Detection Sensor", "Mentions": 45}, {"SRS Part Name": "Air Bag Control Module", "Mentions": 44}, {"SRS Part Name": "Air Bag Module", "Mentions": 26}, {"SRS Part Name": "Steering Column Control Module", "Mentions": 20}, {"SRS Part Name": "Instrument Cluster", "Mentions": 15}], "vin_distribution": [{"scans": 1, "vins": 9932, "percent": 0.6558806048999538}, {"scans": 2, "vins": 3088, "percent": 0.2039226045037311}, {"scans": 3, "vins": 1103, "percent": 0.07283893548174074}, {"scans": 4, "vins": 452, "percent": 0.029848775011556496}, {"scans": 5, "vins": 233, "percent": 0.015386647295780228}, {"scans": 6, "vins": 115, "percent": 0.007594267978603976}, {"scans": 7, "vins": 69, "percent": 0.004556560787162385}, {"scans": 8, "vins": 44, "percent": 0.0029056329657267386}, {"scans": 9, "vins": 34, "percent": 0.00224526183715248}, {"scans": 10, "vins": 18, "percent": 0.0011886680314336657}, {"scans": 11, "vins": 20, "percent": 0.0013207422571485175}, {"scans": 12, "vins": 8, "percent": 0.000528296902859407}, {"scans": 13, "vins": 6, "percent": 0.0003962226771445552}, {"scans": 14, "vins": 3, "percent": 0.0001981113385722776}, {"scans": 15, "vins": 3, "percent": 0.0001981113385722776}, {"scans": 16, "vins": 4, "percent": 0.0002641484514297035}, {"scans": 17, "vins": 2, "percent": 0.00013207422571485174}, {"scans": 18, "vins": 1, "percent": 6.603711285742587e-05}, {"scans": 19, "vins": 1, "percent": 6.603711285742587e-05}, {"scans": 21, "vins": 1, "percent": 6.603711285742587e-05}, {"scans": 23, "vins": 2, "percent": 0.00013207422571485174}, {"scans": 24, "vins": 1, "percent": 6.603711285742587e-05}, {"scans": 26, "vins": 1, "percent": 6.603711285742587e-05}, {"scans": 27, "vins": 1, "percent": 6.603711285742587e-05}, {"scans": 60, "vins": 1, "percent": 6.603711285742587e-05}]};

    function themeColors() {
      const styles = getComputedStyle(document.body);
      return {
        bg: styles.getPropertyValue('--card-bg').trim(),
        plot: styles.getPropertyValue('--plot-bg').trim(),
        text: styles.getPropertyValue('--text').trim(),
        grid: styles.getPropertyValue('--grid').trim(),
        accent1: styles.getPropertyValue('--accent-1').trim(),
        accent2: styles.getPropertyValue('--accent-2').trim(),
        accent3: styles.getPropertyValue('--accent-3').trim(),
      };
    }

    function renderHourly(colors) {
      const data = chartData.hourly || [];
      if (!data.length) return;
      const x = data.map(d => d.Hour);
      const y = data.map(d => d.Scans);
      Plotly.react('hourly-chart', [{
        x, y, type: 'scatter', mode: 'lines+markers', line: {color: colors.accent1}
      }], {
        title: 'Scans in the last 24 hours (Pacific)',
        paper_bgcolor: colors.bg,
        plot_bgcolor: colors.plot,
        font: {color: colors.text},
        xaxis: {gridcolor: colors.grid},
        yaxis: {gridcolor: colors.grid},
        margin: {t: 40, l: 40, r: 20, b: 60}
      });
    }

    function renderStateMap(colors) {
      const data = chartData.scans_by_state || [];
      if (!data.length) return;
      Plotly.react('state-map', [{
        type: 'choropleth',
        locationmode: 'USA-states',
        locations: data.map(d => d.State),
        z: data.map(d => d.Scans),
        colorscale: [
          [0, '#e0f2fe'],
          [1, '#1d4ed8']
        ],
        colorbar: {title: 'Scans'}
      }], {
        title: 'Scans by state',
        paper_bgcolor: colors.bg,
        plot_bgcolor: colors.plot,
        font: {color: colors.text},
        geo: {scope: 'usa', bgcolor: colors.plot},
        margin: {t: 40, l: 20, r: 20, b: 20}
      });
    }

    function renderRepeatMap(colors) {
      const data = chartData.repeat_users_by_state || [];
      if (!data.length) return;
      Plotly.react('repeat-map', [{
        type: 'choropleth',
        locationmode: 'USA-states',
        locations: data.map(d => d.State),
        z: data.map(d => d.RepeatUsers),
        colorscale: [
          [0, '#dcfce7'],
          [1, '#166534']
        ],
        colorbar: {title: 'Repeat users'}
      }], {
        title: 'Repeat users by state',
        paper_bgcolor: colors.bg,
        plot_bgcolor: colors.plot,
        font: {color: colors.text},
        geo: {scope: 'usa', bgcolor: colors.plot},
        margin: {t: 40, l: 20, r: 20, b: 20}
      });
    }

    function renderStateBar(colors) {
      const data = chartData.top_states || [];
      if (!data.length) return;
      Plotly.react('state-bar', [{
        type: 'bar',
        x: data.map(d => d.State),
        y: data.map(d => d.Scans),
        marker: {color: colors.accent1}
      }], {
        title: 'Top states by scans',
        paper_bgcolor: colors.bg,
        plot_bgcolor: colors.plot,
        font: {color: colors.text},
        xaxis: {gridcolor: colors.grid},
        yaxis: {gridcolor: colors.grid},
        margin: {t: 40, l: 40, r: 20, b: 80}
      });
    }

    function renderVehicleBar(colors) {
      const data = chartData.top_vehicles || [];
      if (!data.length) return;
      Plotly.react('vehicle-bar', [{
        type: 'bar',
        x: data.map(d => d.Vehicle),
        y: data.map(d => d.Scans),
        marker: {color: colors.accent2}
      }], {
        title: 'Top vehicles by scans',
        paper_bgcolor: colors.bg,
        plot_bgcolor: colors.plot,
        font: {color: colors.text},
        xaxis: {tickangle: -40, gridcolor: colors.grid},
        yaxis: {gridcolor: colors.grid},
        margin: {t: 40, l: 40, r: 20, b: 120}
      });
    }

    function renderVinDistribution(colors) {
      const data = chartData.vin_distribution || [];
      if (!data.length) return;
      const x = data.map(d => d.scans);
      const y = data.map(d => d.percent * 100);
      const text = data.map(d => `${(d.percent * 100).toFixed(2)}% â€¢ ${d.vins.toLocaleString()} VINs`);
      Plotly.react('vin-chart', [{
        type: 'scatter',
        mode: 'lines+markers',
        x,
        y,
        text,
        line: {color: colors.accent3, width: 3},
        marker: {size: 6},
        hovertemplate: '<b>%{x}x</b><br>%{text}<extra></extra>'
      }], {
        title: 'VINs by number of scans',
        paper_bgcolor: colors.bg,
        plot_bgcolor: colors.plot,
        font: {color: colors.text},
        xaxis: {title: 'Scans per VIN', gridcolor: colors.grid},
        yaxis: {title: 'Share of unique VINs (%)', gridcolor: colors.grid},
        margin: {t: 40, l: 60, r: 20, b: 60}
      });
    }

    function setupVinControls() {
      const select = document.getElementById('vin-select');
      const data = chartData.vin_distribution || [];
      if (!select || !data.length) return;
      if (select.options.length === data.length) return; // already built
      data.forEach((d) => {
        const opt = document.createElement('option');
        opt.value = d.scans;
        opt.textContent = `${d.scans}x`;
        select.appendChild(opt);
      });
      select.value = data[0].scans;
      select.addEventListener('change', updateVinStats);
      updateVinStats();
    }

    function updateVinStats() {
      const data = chartData.vin_distribution || [];
      const select = document.getElementById('vin-select');
      if (!data.length || !select) return;
      const rawValue = select.value || String(data[0].scans);
      const selected = parseInt(rawValue, 10);
      const found = data.find(d => d.scans === selected) || data[0];
      const countEl = document.getElementById('vin-count-value');
      const pctEl = document.getElementById('vin-percent-value');
      if (countEl) countEl.textContent = found.vins.toLocaleString();
      if (pctEl) pctEl.textContent = `${(found.percent * 100).toFixed(2)}%`;
    }

    function renderCharts() {
      const colors = themeColors();
      renderHourly(colors);
      renderStateMap(colors);
      renderRepeatMap(colors);
      renderStateBar(colors);
      renderVehicleBar(colors);
      renderVinDistribution(colors);
      setupVinControls();
    }

    const toggle = document.getElementById('theme-toggle');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('rs2Theme');
    const initialTheme = savedTheme || (prefersDark ? 'dark' : 'light');

    function setTheme(theme) {
      document.body.classList.toggle('dark', theme === 'dark');
      document.body.classList.toggle('light', theme === 'light');
      toggle.textContent = theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
      localStorage.setItem('rs2Theme', theme);
      renderCharts();
    }

    function downloadChart(id, filename) {
      const el = document.getElementById(id);
      if (!el) return;
      Plotly.downloadImage(el, {
        format: 'png',
        filename,
        height: 600,
        width: 900,
      });
    }

    function toCsv(rows) {
      if (!rows || !rows.length) return '';
      const headers = Object.keys(rows[0]);
      const escape = (val) => {
        if (val === null || val === undefined) return '';
        const s = String(val);
        if (/[",\n]/.test(s)) return '"' + s.replace(/"/g, '""') + '"';
        return s;
      };
      const lines = [headers.join(',')];
      rows.forEach((row) => {
        lines.push(headers.map(h => escape(row[h])).join(','));
      });
      return lines.join('\n');
    }

    function downloadTable(key) {
      const data = chartData[key];
      if (!data || !data.length) return;
      const csv = toCsv(data);
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${key}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    toggle.addEventListener('click', () => {
      const next = document.body.classList.contains('dark') ? 'light' : 'dark';
      setTheme(next);
    });

    setTheme(initialTheme);
  </script>
</body>
</html>
